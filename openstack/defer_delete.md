openstack中的延迟删除、软删除、删除保护
-----
#### glance镜像的延迟删除
+ 用法  
glance-api.conf中打开延迟删除开关
``` xml
# Turn on/off delayed delete
delayed_delete = False
 
# Delayed delete time in seconds
scrub_time = 43200
```
删除镜像fedora_s2。
```
[root@controller ~(keystone_admin)]# glance image-list
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
| ID                                   | Name      | Disk Format | Container Format | Size        | Status |
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
| 42d61acd-1ab3-4a7e-a14e-68ad6ba75215 | centos    | iso         | bare             | 358959104   | active |
| a7f49865-0388-48f1-a547-f6f23066fb4f | centos_wc | raw         | bare             | 10737418240 | active |
| f01af3f9-58c3-463d-bf66-fb58825466b4 | fedora_s2 | qcow2       | bare             | 983629824   | active |
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
[root@controller ~(keystone_admin)]# glance image-delete fedora_s2
[root@controller ~(keystone_admin)]# glance image-list
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
| ID                                   | Name      | Disk Format | Container Format | Size        | Status |
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
| 42d61acd-1ab3-4a7e-a14e-68ad6ba75215 | centos    | iso         | bare             | 358959104   | active |
| a7f49865-0388-48f1-a547-f6f23066fb4f | centos_wc | raw         | bare             | 10737418240 | active |
+--------------------------------------+-----------+-------------+------------------+-------------+--------+
```
查看数据库信息, fedora_s2的状态为pending_delete。
```shell
+--------------------------------------+-----------+-----------+----------------+-----------+---------------------+---------------------+---------------------+---------+-------------+------------------+----------------------------------+----------------------------------+----------+---------+-----------+
| id                                   | name      | size      | status         | is_public | created_at          | updated_at          | deleted_at          | deleted | disk_format | container_format | checksum                         | owner                            | min_disk | min_ram | protected |
+--------------------------------------+-----------+-----------+----------------+-----------+---------------------+---------------------+---------------------+---------+-------------+------------------+----------------------------------+----------------------------------+----------+---------+-----------+
| f01af3f9-58c3-463d-bf66-fb58825466b4 | fedora_s2 | 983629824 | pending_delete |         0 | 2014-02-15 15:03:22 | 2014-04-10 17:51:53 | 2014-04-10 17:51:53 |       1 | qcow2       | bare             | c5870838c1c85547d5b85084071db21a | 86196260e1694d0cbb5049cfba3883f8 |       20 |    2048 |         0 |
+--------------------------------------+-----------+-----------+----------------+-----------+---------------------+---------------------+---------------------+---------+-------------+------------------+----------------------------------+----------------------------------+----------+---------+-----------+

```

备注：目前image找回功能的接口还在review中，目前仍不可用。  
+ 实现原理  
实现原理很简单。当打开延迟删除开关后，对image的删除不会立刻触发动作，
而只是记录的状态为pending_delete和删除时间。  
另外glance有个scrubber的清理服务，会周期性检查pending_delete的image是否到期，
到期则进行删除动作。 


#### glance镜像的删除保护
+ 用法

+ 实现原理


#### nova虚拟机的软删除
+ 用法
通过nova.conf，设置回收已删除虚拟机的间隔。  
```xml
# Interval in seconds for reclaiming deleted instances
# (integer value)
#reclaim_instance_interval=0
```
该值为0，则立刻删除。不为0，则为软删除。在该时间到达后，才真正删除虚拟机。  
在该时间到达前，可以通过API将虚拟机找回。  

相关API：
```
# 强制删除（会对虚拟机立刻删除）
POST v2/​{tenant_id}​/servers/​{server_id}​/action
{
    "forceDelete": null
}

# 找回
POST v2/​{tenant_id}​/servers/​{server_id}​/action
{
    "restore": null
}
```
+ 实现原理

